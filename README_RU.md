# Maya Restore Orient Tool

Позволяет восстановить ориентацию объекта на основании выбранных опорных элементов.
Этот инструмент полезен в случаях когда исходный объект был трансформирован в сцене 
и трансформации были заморожены. Например, вся геометрия в сцене слита в единый объект.
После разъединения большого объекта в отдельные объекты Orient Tool поможет вам восстановить трансформации
исходных объектов и переместить их в центр мировых координат.
Также можно вернуть восстановленный объект в исходное место в сцене, но уже с правильными трансформациями.

### Установка

Скопируйте папку `pw_restore_object_orient` в директорию со скриптами для Maya. например `~/maya/scripts`

Для запуска в Maya добавьте кнопку с таким кодом

```python
import pw_maya_restore_orient
pw_maya_restore_orient.show()
```

### Использование

1. Для начала выберите в сцене объект. Это должна быть `Transform` нода. Не важно, один объект или группа. Нажмите кнопку `Set Object`
2. Перейдите в режим выделения компонентов и выберите опорные элементы.
При выделении старайтесь выбрать элементы находящиеся на оси симметрии или расположенные симметрично относительно центральной оси. 
При выделении множества компонентов имеет смысл выбирать копланарные компоненты (лежат в одной плоскости).
Из выбранных компонентов создается опорный вектор с которым в дальнейшем проводятся манипуляции выравнивания и поворотов.
3. Выберите операцию и нажмите соответствующую кнопку в диалоге. 

> Результаты операций выравнивания будут отличаться при зажатых модификаторах `Shift` и `Ctrl`.

### Варианты опорных элементов

- 1 point
- 2 points
- 3 points
- 1 edge
- 2 edges
- multiple edges (more than 2)
- 1 face
- 1 point + 1 edge
- 1 point + 2 edges
- 2 faces
- multiple faces (more than 2)

#### Расчёт исходного вектора

Из любых поддерживаемых комбинаций выделенных компонентов всегда рассчитывается исходный вектор или базис для поворота.
Например, если выделен 1 полигон то его исходный вектор это **нормаль данного полигона**. Если выделено несколько полигонов,
то исходный вектор это **усреднённая нормаль** этих полигонов.
При выделении ребра исходный вектор направлен **вдоль этого ребра**. 
При выделении двух точке вектор будет направлен **из одной точки в другую**.

Это следует учитывать при выборе опорных компонентов.

### Элементы управления диалога

![Dialog](images/img1.png)

#### Current Object

`Set Object` - Выбрать объект с которым будете работать. Это может быть только нода типа `Transform`. 
Если выбрана группа, то все манипуляции будут влиять на все объекты в группе.
С зажатой клавишей `Shift` текущий объект будет сброшен.

#### Align Selected 

`Quick Align` - Быстро выровнять объект используя текущее выделение. С зажатой клавишей `Shift` инвертируется опорный вектор. 
Быстрое выравнивание выбирает ближайшую к опорному вектору мировую ось. Зажмите **Shift**, чтобы инвертировать направление выравнивания. 

`X/Y/Z` - Выровнять объект используя текущее выделение, при этом выделенный опорный элемент будет ориентирован по выбранной оси. 
Зажмите **Shift**, чтобы инвертировать направление этой оси.

#### Rotate Selected To

Группа кнопок для быстрого вращения и выравнивания ориентации.

`X/Y/Z` - Ориентировать объект вдоль выбранной оси относительно выбранного элемента. 
Рассчитанный вектор будет направлен ровно по указанной оси.

`XZ/XY/YZ/YX/ZY/ZX` - Повернуть ось выбранного элемента на выбранную плоскость. Удобно для коррекции ориентации объекта
после основного выравнивания.

По умолчанию выбирается кротчайший путь. Осью поворота будет перпендикуляр к опорному вектору лежащий на указанной плоскости.
Клавиши `Shift` и `Ctrl` изменяют ось поворота. Выбранная ось остается написана на кнопку заглавной буквой.

Например, если выделить ребро и нажать кнопку `XZ` то объект повернётся выбранным ребром к плоскости `xz` по кратчайшему пути.
Если зажать `Shift`, то текст на кнопке изменится на `Xz`, то есть вращение произойдет вдоль оси `X`. 
Если зажать `Ctrl`, то текст изменится на `xZ`, ось вращения будет ось `Z`. 

Это позволить сохранить изначальную ориентацию вдоль указанной оси.

`+90 / -90` - вращение по указанной оси на указанный угол. 
При нажатии `Shift` угол меняется на 180, с клавишей `Ctrl` угол меняется на 180.

#### Set Origin To

`Base` - Переместить объект в центр координат по `X` и `Z` и выровнять самую нижнюю точку в 0 по оси `Y`.

`Center` - Переместить центр объекта в центр мировых координат.

`Selected` - Найти центр выделенных элементов и переместить его в центр мировых координат.

#### Finalize 

`Freeze` - вызвать команду `Modify/Freeze Transformations` для текущего объекта и всех дочерних объектов.

`Reset` - сбросить изменения текущего объекта. 

`Restore Transform` - Восстановить исходное положение объекта в сцене после восстановления трансформаций. 
Опция доступна после команды `Freeze` и пока не сброшен выбор текущего объекта. 
Объект переместится в исходное положение, но уже с правильными трансформациями относительно новой ориентации и позиции.

### API

> todo

### TODO

- Проекция на плоскость пока не рассчитана на работу с полигонами
- Интерфейс для выравнивания множества одинаковых объектов по одному правилу